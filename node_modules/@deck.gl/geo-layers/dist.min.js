!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("deck"),require("h3"),require("S2"));else if("function"==typeof define&&define.amd)define(["deck","h3","S2"],t);else{var n="object"==typeof exports?t(require("deck"),require("h3"),require("S2")):t(e.deck,e.h3,e.S2);for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(window,function(e,t,n){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=10)}([function(t,n){t.exports=e},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},function(e,t,n){var r=n(12),i=n(13);e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?i(e):t}},function(e,t,n){var r=n(15);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},function(e,t,n){var r=n(16),i=n(17),o=n(18);e.exports=function(e,t){return r(e)||i(e,t)||o()}},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t,n){n(1);var r=n(14);function i(t,n,o){return"undefined"!=typeof Reflect&&Reflect.get?e.exports=i=Reflect.get:e.exports=i=function(e,t,n){var i=r(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}},i(t,n,o||t)}e.exports=i},function(e,t,n){(function(t){const r=n(19),i=("undefined"==typeof window?t:window).deck||{};if(!i.LineLayer)throw new Error("@deck.gl/layers is not found");e.exports=Object.assign(i,r)}).call(this,n(11))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=r=function(e){return n(e)}:e.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},r(t)}e.exports=r},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t,n){var r=n(1);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r(e)););return e}},function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,r)}e.exports=n},function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,n){"use strict";n.r(t);var r=n(2),i=n.n(r),o=n(3),a=n.n(o),s=n(4),l=n.n(s),u=n(1),c=n.n(u),f=n(9),d=n.n(f),h=n(5),g=n.n(h),p=n(0),y=function(e){function t(){return i()(this,t),l()(this,c()(t).apply(this,arguments))}return g()(t,e),a()(t,[{key:"getShaders",value:function(){return Object.assign({},d()(c()(t.prototype),"getShaders",this).call(this),{vs:"#define SHADER_NAME great-circle-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec4 instanceSourceColors;\nattribute vec4 instanceTargetColors;\nattribute vec4 instancePositions;\nattribute vec4 instancePositions64Low;\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\n\nuniform float numSegments;\nuniform float opacity;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\n\nvarying vec4 vColor;\n\n// offset vector by strokeWidth pixels\n// offset_direction is -1 (left) or 1 (right)\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset_screenspace = dir_screenspace * offset_direction * width / 2.0;\n  vec2 offset_clipspace = project_pixel_size_to_clipspace(offset_screenspace);\n\n  return offset_clipspace;\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));\n}\n\n// get angular distance in radian\nfloat getAngularDist (vec2 source, vec2 target) {\n  vec2 delta = source - target;\n  vec2 sin_half_delta = sin(delta / 2.0);\n  float a =\n    sin_half_delta.y * sin_half_delta.y +\n    cos(source.y) * cos(target.y) *\n    sin_half_delta.x * sin_half_delta.x;\n  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));\n}\n\nvec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  if(abs(angularDist - PI) < 0.001) {\n    return (1.0 - t) * source + t * target;\n  }\n\n  float a = sin((1.0 - t) * angularDist) / sin(angularDist);\n  float b = sin(t * angularDist) / sin(angularDist);\n  vec2 sin_source = sin(source);\n  vec2 cos_source = cos(source);\n  vec2 sin_target = sin(target);\n  vec2 cos_target = cos(target);\n\n  float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;\n  float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;\n  float z = a * sin_source.y + b * sin_target.y;\n  return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));\n}\n\nvoid main(void) {\n  float segmentIndex = positions.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  \n  // if it's the first point, use next - current as direction\n  // otherwise use current - prev\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  \n  vec2 source = radians(instancePositions.xy);\n  vec2 target = radians(instancePositions.zw);\n  \n  float angularDist = getAngularDist(source, target);\n\n  vec3 currPos = vec3(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0);\n  vec3 nextPos = vec3(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0);\n\n  vec2 currPos64Low = mix(instancePositions64Low.xy, instancePositions64Low.zw, segmentRatio);\n  vec2 nextPos64Low = mix(instancePositions64Low.xy, instancePositions64Low.zw, nextSegmentRatio);\n\n  vec4 curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0));\n  vec4 next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));\n\n  // Multiply out width and clamp to limits\n  // mercator pixels are interpreted as screen pixels\n  float widthPixels = clamp(\n    project_size_to_pixel(instanceWidths * widthScale),\n    widthMinPixels, widthMaxPixels\n  );\n\n  // extrude\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels);\n  gl_Position = curr + vec4(offset, 0.0, 0.0);\n\n  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio) / 255.0;\n  vColor = vec4(color.rgb, color.a * opacity);\n  \n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(instancePickingColors);\n}\n",modules:["picking","project32"]})}}]),t}(p.ArcLayer);y.layerName="GreatCircleLayer";var v=n(6),m=n.n(v),x=n(8);var b=180/Math.PI,L=100;function _(e){var t=function(e){var t=e.padEnd(16,"0");return String(parseInt(t,16))}(e),n=function(e){var t=e.substr(e.length-1);return 2*(e.length-1)-(0==(1&t))}(e);return function(e){for(var t,n,r,i,o,a,s=e.face,l=e.ij,u=e.level,c=[],f=[[0,0],[0,1],[1,1],[1,0],[0,0]],d=Math.max(1,L*Math.pow(2,-u)),h=0;h<4;h++)for(var g=f[h].slice(0),p=f[h+1],y=(p[0]-g[0])/d,v=(p[1]-g[1])/d,_=0;_<d;_++){g[0]+=y,g[1]+=v;var P=x.S2.IJToST(l,u,g),S=x.S2.STToUV(P),w=x.S2.FaceUVToXYZ(s,S);c.push((t=w,n=void 0,r=void 0,i=void 0,o=void 0,a=void 0,n=m()(t,3),r=n[0],i=n[1],o=n[2],a=Math.atan2(o,Math.sqrt(r*r+i*i)),[Math.atan2(i,r)*b,a*b]))}return c}(x.S2.S2Cell.FromLatLng(x.S2.idToLatLng(t),n))}var P=Object.assign({getS2Token:{type:"accessor",value:function(e){return e.token}}},p.PolygonLayer.defaultProps),S=function(e){function t(){return i()(this,t),l()(this,c()(t).apply(this,arguments))}return g()(t,e),a()(t,[{key:"renderLayers",value:function(){var e=this.props,t=e.data,n=e.getS2Token,r=this.props,i=r.elevationScale,o=r.extruded,a=r.wireframe,s=r.filled,l=r.stroked,u=r.lineWidthUnits,c=r.lineWidthScale,f=r.lineWidthMinPixels,d=r.lineWidthMaxPixels,h=r.lineJointRounded,g=r.lineMiterLimit,y=r.lineDashJustified,v=r.fp64,m=r.getElevation,x=r.getFillColor,b=r.getLineColor,L=r.getLineWidth,P=r.getLineDashArray,S=this.props,w=S.updateTriggers,T=S.material;return new(this.getSubLayerClass("cell",p.PolygonLayer))({fp64:v,filled:s,wireframe:a,extruded:o,elevationScale:i,stroked:l,lineWidthUnits:u,lineWidthScale:c,lineWidthMinPixels:f,lineWidthMaxPixels:d,lineJointRounded:h,lineMiterLimit:g,lineDashJustified:y,material:T,getElevation:m,getFillColor:x,getLineColor:b,getLineWidth:L,getLineDashArray:P},this.getSubLayerProps({id:"cell",updateTriggers:{getElevation:w.getElevation,getFillColor:w.getFillColor,getLineColor:w.getLineColor,getLineWidth:w.getLineWidth,getLineDashArray:w.getLineDashArray}}),{data:t,getPolygon:function(e){return _(n(e))}})}}]),t}(p.CompositeLayer);function w(e,t,n){var r=e/Math.pow(2,n)*360-180,i=Math.PI-2*Math.PI*t/Math.pow(2,n);return[r,180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)))]}S.layerName="S2Layer",S.defaultProps=P;var T=function(){function e(t){var n=t.getTileData,r=t.x,o=t.y,a=t.z,s=t.onTileError;i()(this,e),this.x=r,this.y=o,this.z=a,this.bbox=function(e,t,n){var r=w(e,t,n),i=m()(r,2),o=i[0],a=i[1],s=w(e+1,t+1,n),l=m()(s,2);return{west:o,north:a,east:l[0],south:l[1]}}(this.x,this.y,this.z),this.isVisible=!0,this.getTileData=n,this._data=null,this._isLoaded=!1,this._loader=this._loadData(),this.onTileError=s}return a()(e,[{key:"_loadData",value:function(){var e=this,t=this.x,n=this.y,r=this.z,i=this.bbox;return this.getTileData?this.getTileData({x:t,y:n,z:r,bbox:i}).then(function(t){return e._data=t,e._isLoaded=!0,t}).catch(function(t){e._isLoaded=!0,e.onTileError(t)}):null}},{key:"isOverlapped",value:function(e){var t=this.x,n=this.y,r=this.z,i=Math.pow(2,e.z-r);return Math.floor(e.x/i)===t&&Math.floor(e.y/i)===n}},{key:"data",get:function(){return this._data?Promise.resolve(this._data):this._loader}},{key:"isLoaded",get:function(){return this._isLoaded}}]),e}();function C(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var j="undefined"!=typeof Float32Array?Float32Array:Array;Math.random;Math.PI;var M,k;M=new j(4),j!=Float32Array&&(M[0]=0,M[1]=0,M[2]=0,M[3]=0),k=M;!function(){var e,t=(e=new j(2),j!=Float32Array&&(e[0]=0,e[1]=0),e)}();!function(){var e,t=(e=new j(3),j!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e)}();function z(e,t){if(!e)throw new Error(t||"viewport-mercator-project: assertion failed.")}var O=Math.PI,D=O/4,E=O/180,W=512;function I(e,t){var n=C(e,2),r=n[0],i=n[1];z(Number.isFinite(r)&&Number.isFinite(t)),z(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");var o=i*E;return[(t*=W)*(r*E+O)/(2*O),t*(O-Math.log(Math.tan(D+.5*o)))/(2*O)]}var F=512;function A(e){return e/F}function H(e,t){var n=e.x,r=e.y,i=e.z,o=Math.pow(2,i-t);return{x:Math.floor(n/o),y:Math.floor(r/o),z:t}}var Z=function(){function e(t){var n=t.getTileData,r=t.maxSize,o=t.maxZoom,a=t.minZoom,s=t.onTileError;i()(this,e),this._getTileData=n,this._maxSize=r,this.onTileError=s,this._cache=new Map,o&&parseInt(o,10)===o&&(this._maxZoom=o),a&&parseInt(a,10)===a&&(this._minZoom=a)}return a()(e,[{key:"finalize",value:function(){this._cache.clear()}},{key:"update",value:function(e,t){var n=this._cache,r=this._getTileData,i=this._maxSize,o=this._maxZoom,a=this._minZoom;this._markOldTiles();var s=function(e,t,n){var r=Math.floor(e.zoom);if(n&&r<n)return[];var i=function(e){var t=[e.unproject([0,0]),e.unproject([e.width,0]),e.unproject([0,e.height]),e.unproject([e.width,e.height])];return[t.reduce(function(e,t){return e<t[0]?e:t[0]},180),t.reduce(function(e,t){return e<t[1]?e:t[1]},90),t.reduce(function(e,t){return e>t[0]?e:t[0]},-180),t.reduce(function(e,t){return e>t[1]?e:t[1]},-90)]}(e=new e.constructor(Object.assign({},e,{zoom:r}))),o=I([i[0],i[3]],e.scale).map(A),a=m()(o,2),s=a[0],l=a[1],u=I([i[2],i[1]],e.scale).map(A),c=m()(u,2),f=c[0],d=c[1];s=Math.max(0,Math.floor(s)),f=Math.min(e.scale,Math.ceil(f)),l=Math.max(0,Math.floor(l)),d=Math.min(e.scale,Math.ceil(d));for(var h=[],g=s;g<f;g++)for(var p=l;p<d;p++)t&&r>t?h.push(H({x:g,y:p,z:r},t)):h.push({x:g,y:p,z:r});return h}(e,o,a);if(s&&0!==s.length){var l=new Set;n.forEach(function(e){s.some(function(t){return e.isOverlapped(t)})&&(e.isVisible=!0,l.add(e))});for(var u=0;u<s.length;u++){var c=s[u],f=c.x,d=c.y,h=c.z,g=this._getTile(f,d,h);g||(g=new T({getTileData:r,x:f,y:d,z:h,onTileError:this.onTileError}));var p=this._getTileId(f,d,h);n.set(p,g),l.add(g)}this._resizeCache(i||5*s.length),t(Array.from(l).sort(function(e,t){return e.z-t.z}))}else t(s)}},{key:"_resizeCache",value:function(e){var t=this._cache;if(t.size>e){var n=t[Symbol.iterator](),r=!0,i=!1,o=void 0;try{for(var a,s=n[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var l=a.value;if(t.size<=e)break;var u=l[0];l[1].isVisible||t.delete(u)}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}}}},{key:"_markOldTiles",value:function(){this._cache.forEach(function(e){e.isVisible=!1})}},{key:"_getTile",value:function(e,t,n){var r=this._getTileId(e,t,n);return this._cache.get(r)}},{key:"_getTileId",value:function(e,t,n){return"".concat(n,"-").concat(e,"-").concat(t)}}]),e}(),R={renderSubLayers:{type:"function",value:function(e){return new p.GeoJsonLayer(e)}},getTileData:{type:"function",value:function(e){e.x,e.y,e.z;return Promise.resolve(null)}},onViewportLoaded:{type:"function",value:function(){}},onTileError:{type:"function",value:function(e){return console.error(e)}},maxZoom:null,minZoom:0,maxCacheSize:null},U=function(e){function t(){return i()(this,t),l()(this,c()(t).apply(this,arguments))}return g()(t,e),a()(t,[{key:"initializeState",value:function(){var e=this.props,t=e.maxZoom,n=e.minZoom,r=e.getTileData,i=e.onTileError;this.state={tiles:[],tileCache:new Z({getTileData:r,maxZoom:t,minZoom:n,onTileError:i}),isLoaded:!1}}},{key:"shouldUpdateState",value:function(e){return e.changeFlags.somethingChanged}},{key:"updateState",value:function(e){var t=this,n=e.props,r=(e.oldProps,e.context),i=e.changeFlags,o=n.onViewportLoaded,a=n.onTileError;if(i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getTileData)){var s=n.getTileData,l=n.maxZoom,u=n.minZoom,c=n.maxCacheSize;this.state.tileCache.finalize(),this.setState({tileCache:new Z({getTileData:s,maxSize:c,maxZoom:l,minZoom:u,onTileError:a})})}if(i.viewportChanged){var f=r.viewport,d=this.getLayerZoomLevel();"DEFAULT-INITIAL-VIEWPORT"!==f.id&&this.state.tileCache.update(f,function(e){var n=e.filter(function(e){return e.z===d}),r=n.every(function(e){return e.isLoaded});t.setState({tiles:e,isLoaded:r}),r?o(n.filter(function(e){return e._data}).map(function(e){return e._data})):Promise.all(n.map(function(e){return e.data})).then(function(){t.setState({isLoaded:!0}),o(n.filter(function(e){return e._data}).map(function(e){return e._data}))})})}}},{key:"getPickingInfo",value:function(e){var t=e.info,n=e.sourceLayer;return t.sourceLayer=n,t.tile=n.props.tile,t}},{key:"getLayerZoomLevel",value:function(){var e=Math.floor(this.context.viewport.zoom),t=this.props,n=t.maxZoom,r=t.minZoom;return n&&parseInt(n,10)===n&&e>n?n:r&&parseInt(r,10)===r&&e<r?r:e}},{key:"renderLayers",value:function(){var e=this,t=this.props,n=t.renderSubLayers,r=t.visible,i=this.getLayerZoomLevel();return this.state.tiles.map(function(t){return n(Object.assign({},e.props,{id:"".concat(e.id,"-").concat(t.x,"-").concat(t.y,"-").concat(t.z),data:t.data,visible:r&&(!e.state.isLoaded||t.z===i),tile:t}))})}}]),t}(p.CompositeLayer);U.layerName="TileLayer",U.defaultProps=R;var N=function(e){function t(){return i()(this,t),l()(this,c()(t).apply(this,arguments))}return g()(t,e),a()(t,[{key:"getShaders",value:function(){var e=d()(c()(t.prototype),"getShaders",this).call(this);return e.inject={"vs:#decl":"uniform float trailLength;\nvarying float vTime;\n","vec3 pos = lineJoin(prevPosition, currPosition, nextPosition);":"pos.z = 0.0;","vs:#main-end":"float shiftZ = mod(instanceEndPositions.z, trailLength) * 1e-4;\ngl_Position.z += shiftZ;\nvTime = instanceStartPositions.z + (instanceEndPositions.z - instanceStartPositions.z) * vPathPosition.y / vPathLength;\n","fs:#decl":"uniform float trailLength;\nuniform float currentTime;\nvarying float vTime;\n","fs:#main-start":"if(vTime > currentTime || vTime < currentTime - trailLength) {\n  discard;\n}\n","gl_FragColor = vColor;":"gl_FragColor.a *= 1.0 - (currentTime - vTime) / trailLength;"},e}},{key:"draw",value:function(e){var n=this.props,r=n.trailLength,i=n.currentTime;e.uniforms=Object.assign({},e.uniforms,{trailLength:r,currentTime:i}),d()(c()(t.prototype),"draw",this).call(this,e)}}]),t}(p.PathLayer);N.layerName="TripsLayer",N.defaultProps={trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0}};var V=n(7),J=Object.assign({getHexagons:{type:"accessor",value:function(e){return e.hexagons}}},p.PolygonLayer.defaultProps),q=function(e){function t(){return i()(this,t),l()(this,c()(t).apply(this,arguments))}return g()(t,e),a()(t,[{key:"updateState",value:function(e){var t=e.props,n=(e.oldProps,e.changeFlags);if(n.dataChanged||n.updateTriggers&&n.updateTriggers.getHexagons){var r=t.data,i=t.getHexagons,o=[],a=Object(p.createIterable)(r),s=a.iterable,l=a.objectInfo,u=!0,c=!1,f=void 0;try{for(var d,h=s[Symbol.iterator]();!(u=(d=h.next()).done);u=!0){var g=d.value;l.index++;var y=i(g,l),v=Object(V.h3SetToMultiPolygon)(y,!0),m=!0,x=!1,b=void 0;try{for(var L,_=v[Symbol.iterator]();!(m=(L=_.next()).done);m=!0){var P=L.value;o.push({polygon:P,_obj:g,_idx:l.index})}}catch(e){x=!0,b=e}finally{try{m||null==_.return||_.return()}finally{if(x)throw b}}}}catch(e){c=!0,f=e}finally{try{u||null==h.return||h.return()}finally{if(c)throw f}}this.setState({polygons:o})}}},{key:"getPickingInfo",value:function(e){var t=e.info;return Object.assign(t,{object:t.object&&t.object._obj,index:t.object&&t.object._idx})}},{key:"getSubLayerAccessor",value:function(e){return"function"!=typeof e?e:function(t,n){return e(t._obj,n)}}},{key:"renderLayers",value:function(){var e=this.props,t=e.elevationScale,n=e.extruded,r=e.wireframe,i=e.filled,o=e.stroked,a=e.lineWidthScale,s=e.lineWidthMinPixels,l=e.lineWidthMaxPixels,u=e.lineJointRounded,c=e.lineMiterLimit,f=e.lineDashJustified,d=e.fp64,h=e.material,g=e.getFillColor,y=e.getLineColor,v=e.getLineWidth,m=e.getLineDashArray,x=e.getElevation,b=e.updateTriggers;return new(this.getSubLayerClass("cluster-region",p.PolygonLayer))({fp64:d,filled:i,wireframe:r,extruded:n,elevationScale:t,stroked:o,lineWidthScale:a,lineWidthMinPixels:s,lineWidthMaxPixels:l,lineJointRounded:u,lineMiterLimit:c,lineDashJustified:f,material:h,getFillColor:this.getSubLayerAccessor(g),getLineColor:this.getSubLayerAccessor(y),getLineWidth:this.getSubLayerAccessor(v),getLineDashArray:this.getSubLayerAccessor(m),getElevation:this.getSubLayerAccessor(x)},this.getSubLayerProps({id:"cluster-region",updateTriggers:b}),{data:this.state.polygons,getPolygon:function(e){return e.polygon}})}}]),t}(p.CompositeLayer);q.defaultProps=J,q.layerName="H3ClusterLayer";function G(e,t,n){var r=e(t,n),i=Object(V.h3ToGeo)(r),o=m()(i,2),a=o[0];return[o[1],a]}function K(e){var t=Object(V.h3ToGeoBoundary)(e,!0),n=t[0][0],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var l=a.value,u=l[0]-n;u>180?l[0]-=360:u<-180&&(l[0]+=360)}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return t}var B=Object.assign({},p.PolygonLayer.defaultProps,{highPrecision:!1,coverage:{type:"number",min:0,max:1,value:1},getHexagon:{type:"accessor",value:function(e){return e.hexagon}},extruded:!0,getColor:null}),X=function(e){function t(){return i()(this,t),l()(this,c()(t).apply(this,arguments))}return g()(t,e),a()(t,[{key:"shouldUpdateState",value:function(e){var t=e.changeFlags;return this._shouldUseHighPrecision()?t.propsOrDataChanged:t.somethingChanged}},{key:"updateState",value:function(e){var t=e.props,n=(e.oldProps,e.changeFlags);if(n.dataChanged||n.updateTriggers&&n.updateTriggers.getHexagon){var r=-1,i=!1,o=Object(p.createIterable)(t.data),a=o.iterable,s=o.objectInfo,l=!0,u=!1,c=void 0;try{for(var f,d=a[Symbol.iterator]();!(l=(f=d.next()).done);l=!0){var h=f.value;s.index++;var g=t.getHexagon(h,s);if(r=r<0?Object(V.h3GetResolution)(g):r,Object(V.h3IsPentagon)(g)){i=!0;break}}}catch(e){u=!0,c=e}finally{try{l||null==d.return||d.return()}finally{if(u)throw c}}this.setState({resolution:r,edgeLengthKM:r>=0?Object(V.edgeLength)(r,V.UNITS.km):0,hasPentagon:i,vertices:null})}this._updateVertices(this.context.viewport)}},{key:"_shouldUseHighPrecision",value:function(){var e=this.state,t=e.resolution,n=e.hasPentagon;return this.props.highPrecision||n||t>=0&&t<=5}},{key:"_updateVertices",value:function(e){if(!this._shouldUseHighPrecision()){var t=this.state,n=t.resolution,r=t.edgeLengthKM,i=t.centerHex;if(!(n<0)){var o=Object(V.geoToH3)(e.latitude,e.longitude,n);if(!(i===o||i&&Object(V.h3Distance)(i,o)*r<10)){var a=e.distanceScales.pixelsPerMeter,s=K(o),l=Object(V.h3ToGeo)(o),u=m()(l,2),c=u[0],f=u[1],d=e.projectFlat([f,c]),h=m()(d,2),g=h[0],p=h[1];s=s.map(function(t){var n=e.projectFlat(t);return n[0]=(n[0]-g)/a[0],n[1]=(n[1]-p)/a[1],n}),this.setState({centerHex:o,vertices:s})}}}}},{key:"renderLayers",value:function(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}},{key:"_getForwardProps",value:function(){var e=this.props,t=e.elevationScale,n=e.fp64,r=e.material,i=e.extruded,o=e.wireframe,a=e.stroked,s=e.filled,l=e.lineWidthUnits,u=e.lineWidthScale,c=e.lineWidthMinPixels,f=e.lineWidthMaxPixels,d=e.getColor,h=e.getFillColor,g=e.getElevation,p=e.getLineColor,y=e.getLineWidth,v=e.updateTriggers;return{elevationScale:t,fp64:n,extruded:i,wireframe:o,stroked:a,filled:s,lineWidthUnits:l,lineWidthScale:u,lineWidthMinPixels:c,lineWidthMaxPixels:f,material:r,getElevation:g,getFillColor:d||h,getLineColor:p,getLineWidth:y,updateTriggers:{getFillColor:v.getColor||v.getFillColor,getElevation:v.getElevation,getLineColor:v.getLineColor,getLineWidth:v.getLineWidth}}}},{key:"_renderPolygonLayer",value:function(){var e=this.props,t=e.data,n=e.getHexagon,r=e.updateTriggers,i=this.getSubLayerClass("hexagon-cell-hifi",p.PolygonLayer),o=this._getForwardProps();return o.updateTriggers.getPolygon=r.getHexagon,new i(o,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:o.updateTriggers}),{data:t,getPolygon:function(e,t){return K(n(e,t))}})}},{key:"_renderColumnLayer",value:function(){var e=this.props,t=e.data,n=e.getHexagon,r=e.updateTriggers,i=this.getSubLayerClass("hexagon-cell",p.ColumnLayer),o=this._getForwardProps();return o.updateTriggers.getPosition=r.getHexagon,new i(o,this.getSubLayerProps({id:"hexagon-cell",updateTriggers:o.updateTriggers}),{data:t,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:G.bind(null,n)})}}]),t}(p.CompositeLayer);X.defaultProps=B,X.layerName="H3HexagonLayer",n.d(t,"GreatCircleLayer",function(){return y}),n.d(t,"S2Layer",function(){return S}),n.d(t,"TileLayer",function(){return U}),n.d(t,"TripsLayer",function(){return N}),n.d(t,"H3ClusterLayer",function(){return q}),n.d(t,"H3HexagonLayer",function(){return X})}])});