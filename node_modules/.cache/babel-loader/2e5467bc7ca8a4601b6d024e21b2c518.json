{"ast":null,"code":"import _objectSpread from \"/Users/admin/Desktop/visualization/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nvar _jsxFileName = \"/Users/admin/Desktop/visualization/src/App.js\";\nimport React, { Component } from 'react';\nimport MapGL, { Marker, FlyToInterpolator } from 'react-map-gl';\nimport openSocket from 'socket.io-client';\nimport 'mapbox-gl/dist/mapbox-gl.css';\nimport { IconLayer, PathLayer, ScatterplotLayer } from '@deck.gl/layers';\nimport DeckGL from '@deck.gl/react';\nimport { StaticMap } from 'react-map-gl';\nimport busicon from \"./busicon.png\";\nimport ControlPanel from './control-panel';\nconst MAPBOX_ACCESS_TOKEN = 'pk.eyJ1IjoiYXM0NzIiLCJhIjoiY2p3MGFmdnVoMDhiMDQwa3RkZno4Z2NncCJ9.MssP16N-csE73s0v2p_z8A';\nconst ICON_MAPPING = {\n  marker: {\n    x: 0,\n    y: 0,\n    width: 512,\n    height: 512,\n    mask: false,\n    anchorY: 512\n  }\n};\nconst ti = [{\n  \"name\": \"Lafayette (LAFY)\",\n  \"code\": \"LF\",\n  \"address\": \"3601 Deer Hill Road, Lafayette CA 94549\",\n  \"entries\": \"3481\",\n  \"exits\": \"3616\",\n  \"coordinates\": [-122.123801, 37.893394]\n}, {\n  \"name\": \"12th St. Oakland City Center (12TH)\",\n  \"code\": \"12\",\n  \"address\": \"1245 Broadway, Oakland CA 94612\",\n  \"entries\": \"13418\",\n  \"exits\": \"13547\",\n  \"coordinates\": [-122.271604, 37.803664]\n}, {\n  \"name\": \"16th St. Mission (16TH)\",\n  \"code\": \"16\",\n  \"address\": \"2000 Mission Street, San Francisco CA 94110\",\n  \"entries\": \"12409\",\n  \"exits\": \"12351\",\n  \"coordinates\": [-122.419694, 37.765062]\n}, {\n  \"name\": \"19th St. Oakland (19TH)\",\n  \"code\": \"19\",\n  \"address\": \"1900 Broadway, Oakland CA 94612\",\n  \"entries\": \"13108\",\n  \"exits\": \"13090\",\n  \"coordinates\": [-122.269029, 37.80787]\n}, {\n  \"name\": \"24th St. Mission (24TH)\",\n  \"code\": \"24\",\n  \"address\": \"2800 Mission Street, San Francisco CA 94110\",\n  \"entries\": \"12817\",\n  \"exits\": \"12529\",\n  \"coordinates\": [-122.418466, 37.752254]\n}, {\n  \"name\": \"Ashby (ASHB)\",\n  \"code\": \"AS\",\n  \"address\": \"3100 Adeline Street, Berkeley CA 94703\",\n  \"entries\": \"5452\",\n  \"exits\": \"5341\",\n  \"coordinates\": [-122.26978, 37.853024]\n}, {\n  \"name\": \"Balboa Park (BALB)\",\n  \"code\": \"BP\",\n  \"address\": \"401 Geneva Avenue, San Francisco CA 94112\",\n  \"entries\": \"11170\",\n  \"exits\": \"9817\",\n  \"coordinates\": [-122.447414, 37.721981]\n}];\nconst INITIAL_VIEW_STATE = {\n  latitude: 21.146633,\n  longitude: 79.088860,\n  zoom: 5,\n  bearing: 0,\n  pitch: 0,\n  width: 100,\n  height: 100\n};\nexport default class App extends Component {\n  constructor(props) {\n    super(props);\n\n    this._onViewportChange = ({\n      viewState\n    }) => {\n      this.setState({\n        viewport: _objectSpread({}, this.state.viewport, viewState)\n      });\n\n      if (this.state.expandedObjects) {\n        this.setState({\n          expandedObjects: null,\n          hoveredObject: null\n        });\n      }\n    };\n\n    this._resize = () => this._onViewportChange({\n      width: this.props.width || window.innerWidth,\n      height: this.props.height || window.innerHeight\n    });\n\n    this.state = {\n      viewport: {\n        latitude: 21.146633,\n        longitude: 79.088860,\n        zoom: 4,\n        bearing: 0,\n        pitch: 0,\n        width: 100,\n        height: 100\n      },\n      data: [],\n      stops: [],\n      stops1: [],\n      hoveredObject: null,\n      expandedObjects: null,\n      x: 0,\n      y: 0\n    };\n    this._onHover = this._onHover.bind(this);\n    this._onClick = this._onClick.bind(this);\n    this._closePopup = this._closePopup.bind(this);\n    this._renderhoveredItems = this._renderhoveredItems.bind(this);\n  }\n\n  _onHover(info) {\n    // if (this.state.expandedObjects) {\n    //   return;\n    // }\n    const x = info.x,\n          y = info.y,\n          object = info.object;\n    this.setState({\n      x,\n      y,\n      hoveredObject: object\n    });\n  }\n\n  _onClick(info) {\n    const _this$props$showClust = this.props.showCluster,\n          showCluster = _this$props$showClust === void 0 ? true : _this$props$showClust;\n    const x = info.x,\n          y = info.y,\n          objects = info.objects,\n          object = info.object;\n\n    if (object && showCluster) {\n      this.setState({\n        viewport: _objectSpread({}, this.state.viewport, {\n          latitude: object.latitude,\n          longitude: object.longitude,\n          zoom: 12\n        }),\n        x,\n        y,\n        expandedObjects: objects || [object]\n      });\n    } else {\n      this._closePopup();\n    }\n  }\n\n  _closePopup() {\n    if (this.state.expandedObjects) {\n      this.setState({\n        hoveredObject: null\n      });\n    }\n  }\n\n  _renderhoveredItems() {\n    const _this$state = this.state,\n          x = _this$state.x,\n          y = _this$state.y,\n          hoveredObject = _this$state.hoveredObject; // if (expandedObjects) {\n    //   return (\n    //     <div className=\"tooltip interactive\" style={{ left: x, top: y }}>\n    //       {\n    //         expandedObjects.map(({ source_type, driver_name, vehicle_number }) => {\n    //           return (\n    //             <div key=\"Details\">\n    //               <h4>Details</h4>\n    //               <div>Driver Name: {driver_name}</div>\n    //               <div>Vehicle Number: {vehicle_number}</div>\n    //             </div>\n    //           );\n    //         })}\n    //     </div>\n    //   );\n    // }\n\n    if (!hoveredObject) {\n      return null;\n    }\n\n    return hoveredObject && React.createElement(\"div\", {\n      className: \"tooltip\",\n      style: {\n        left: x,\n        top: y\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123\n      },\n      __self: this\n    }, hoveredObject.vehicle_number);\n  }\n\n  async componentDidMount() {\n    await fetch(\"https://service-panel-backend.shuttltech.com/api/v1/routes/125e9bde-22c0-4e5d-936d-66dcadc74174/path\", {\n      \"credentials\": \"omit\",\n      \"headers\": {\n        \"accept\": \"application/json, text/plain, */*\",\n        \"x-session-id\": \"633K4LTHCBNXWVS3DOGUW44MGH7ICKVOBNP7QUEVD5J3JRPBFVLWCZWGPESIXXV7NGNVR5RTD66X3OZYPKKOVC6DUYIBTBGVAOSEJYA\"\n      },\n      \"referrer\": \"https://service-panel.shuttltech.com/trip/01a035d8-7436-43f4-b311-9ac3916af099\",\n      \"referrerPolicy\": \"no-referrer-when-downgrade\",\n      \"body\": null,\n      \"method\": \"GET\",\n      \"mode\": \"cors\"\n    }).then(_ => _.json()).then(json => this.setState({\n      data: [{\n        path: json.data.locations.map(item => [item.lng, item.lat])\n      }],\n      stops: json.data.way_points.map(item => [item.point.location.lng, item.point.location.lat])\n    }));\n    const socket = openSocket('http://127.0.0.1:5000');\n    socket.emit('my event', {\n      Arpit: \"Hello!\"\n    }); // socket.emit('my event', this.state.stops)\n\n    socket.on('my response', data => this.setState({\n      stops1: data\n    }));\n    window.addEventListener('resize', this._resize);\n\n    this._resize();\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('resize', this._resize);\n  }\n\n  _renderLayers() {\n    const layer2 = new ScatterplotLayer({\n      id: 'scatterplot-layer',\n      data: ti,\n      pickable: true,\n      opacity: 0.8,\n      stroked: true,\n      filled: true,\n      radiusScale: 6,\n      radiusMinPixels: 1,\n      radiusMaxPixels: 100,\n      lineWidthMinPixels: 1,\n      getPosition: d => d.coordinates,\n      getRadius: d => Math.sqrt(d.exits),\n      getFillColor: d => [255, 140, 0],\n      getLineColor: d => [0, 0, 0],\n      onHover: ({\n        object,\n        x,\n        y\n      }) => {\n        const tooltip = \"\".concat(object.name, \"\\n\").concat(object.address);\n        /* Update tooltip\n           http://deck.gl/#/documentation/developer-guide/adding-interactivity?section=example-display-a-tooltip-for-hovered-object\n        */\n      }\n    });\n    const layer = new PathLayer({\n      id: 'path-layer',\n      data: this.state.data,\n      pickable: true,\n      widthScale: 2,\n      widthMinPixels: 2,\n      opacity: 0.8,\n      getPath: d => {\n        return d.path;\n      },\n      getColor: d => [255, 0, 0],\n      getWidth: d => 4\n    });\n    const layer1 = new IconLayer({\n      id: 'icon-layer',\n      // data: Array(5000).fill(this.state.stops1).flat(),\n      data: this.state.stops1,\n      pickable: true,\n      iconAtlas: busicon,\n      iconMapping: ICON_MAPPING,\n      getIcon: d => 'marker',\n      sizeScale: 15,\n      // getPosition: (d, a) => [d.longitude + (a.index * 0.01), d.latitude + (a.index * 0.01)],\n      getPosition: d => [d.lng, d.lat],\n      getSize: d => 4,\n      getColor: d => [14, 200, 50],\n      onHover: this._onHover,\n      onClick: this._onClick\n    }); // if(this.state.expandedObjects)\n    // return [layer2];\n    // else return [layer2];\n\n    return [layer, layer2];\n  }\n\n  render() {\n    const viewport = this.state.viewport;\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 247\n      },\n      __self: this\n    }, React.createElement(DeckGL, {\n      viewState: viewport,\n      initialViewState: INITIAL_VIEW_STATE,\n      controller: true,\n      layers: this._renderLayers(),\n      onViewStateChange: this._onViewportChange,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 248\n      },\n      __self: this\n    }, React.createElement(StaticMap, {\n      mapboxApiAccessToken: MAPBOX_ACCESS_TOKEN,\n      mapStyle: \"mapbox://styles/mapbox/dark-v9\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 256\n      },\n      __self: this\n    }), this._renderhoveredItems), React.createElement(ControlPanel, {\n      containerComponent: this.props.containerComponent,\n      propp: this.state,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 261\n      },\n      __self: this\n    }));\n  }\n\n}","map":{"version":3,"sources":["/Users/admin/Desktop/visualization/src/App.js"],"names":["React","Component","MapGL","Marker","FlyToInterpolator","openSocket","IconLayer","PathLayer","ScatterplotLayer","DeckGL","StaticMap","busicon","ControlPanel","MAPBOX_ACCESS_TOKEN","ICON_MAPPING","marker","x","y","width","height","mask","anchorY","ti","INITIAL_VIEW_STATE","latitude","longitude","zoom","bearing","pitch","App","constructor","props","_onViewportChange","viewState","setState","viewport","state","expandedObjects","hoveredObject","_resize","window","innerWidth","innerHeight","data","stops","stops1","_onHover","bind","_onClick","_closePopup","_renderhoveredItems","info","object","showCluster","objects","left","top","vehicle_number","componentDidMount","fetch","then","_","json","path","locations","map","item","lng","lat","way_points","point","location","socket","emit","Arpit","on","addEventListener","componentWillUnmount","removeEventListener","_renderLayers","layer2","id","pickable","opacity","stroked","filled","radiusScale","radiusMinPixels","radiusMaxPixels","lineWidthMinPixels","getPosition","d","coordinates","getRadius","Math","sqrt","exits","getFillColor","getLineColor","onHover","tooltip","name","address","layer","widthScale","widthMinPixels","getPath","getColor","getWidth","layer1","iconAtlas","iconMapping","getIcon","sizeScale","getSize","onClick","render","containerComponent"],"mappings":";;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,OAAOC,KAAP,IAAgBC,MAAhB,EAAwBC,iBAAxB,QAAiD,cAAjD;AACA,OAAOC,UAAP,MAAuB,kBAAvB;AACA,OAAO,8BAAP;AACA,SAASC,SAAT,EAAoBC,SAApB,EAA+BC,gBAA/B,QAAuD,iBAAvD;AACA,OAAOC,MAAP,MAAmB,gBAAnB;AACA,SAASC,SAAT,QAA0B,cAA1B;AACA,OAAOC,OAAP,MAAoB,eAApB;AACA,OAAOC,YAAP,MAAyB,iBAAzB;AAGA,MAAMC,mBAAmB,GAAG,wFAA5B;AACA,MAAMC,YAAY,GAAG;AACnBC,EAAAA,MAAM,EAAE;AAAEC,IAAAA,CAAC,EAAE,CAAL;AAAQC,IAAAA,CAAC,EAAE,CAAX;AAAcC,IAAAA,KAAK,EAAE,GAArB;AAA0BC,IAAAA,MAAM,EAAE,GAAlC;AAAuCC,IAAAA,IAAI,EAAE,KAA7C;AAAoDC,IAAAA,OAAO,EAAE;AAA7D;AADW,CAArB;AAIA,MAAMC,EAAE,GAAC,CACP;AAAC,UAAO,kBAAR;AAA2B,UAAO,IAAlC;AAAuC,aAAU,yCAAjD;AAA2F,aAAU,MAArG;AAA4G,WAAQ,MAApH;AAA2H,iBAAc,CAAC,CAAC,UAAF,EAAa,SAAb;AAAzI,CADO,EAEP;AAAC,UAAO,qCAAR;AAA8C,UAAO,IAArD;AAA0D,aAAU,iCAApE;AAAsG,aAAU,OAAhH;AAAwH,WAAQ,OAAhI;AAAwI,iBAAc,CAAC,CAAC,UAAF,EAAa,SAAb;AAAtJ,CAFO,EAGP;AAAC,UAAO,yBAAR;AAAkC,UAAO,IAAzC;AAA8C,aAAU,6CAAxD;AAAsG,aAAU,OAAhH;AAAwH,WAAQ,OAAhI;AAAwI,iBAAc,CAAC,CAAC,UAAF,EAAa,SAAb;AAAtJ,CAHO,EAIP;AAAC,UAAO,yBAAR;AAAkC,UAAO,IAAzC;AAA8C,aAAU,iCAAxD;AAA0F,aAAU,OAApG;AAA4G,WAAQ,OAApH;AAA4H,iBAAc,CAAC,CAAC,UAAF,EAAa,QAAb;AAA1I,CAJO,EAKP;AAAC,UAAO,yBAAR;AAAkC,UAAO,IAAzC;AAA8C,aAAU,6CAAxD;AAAsG,aAAU,OAAhH;AAAwH,WAAQ,OAAhI;AAAwI,iBAAc,CAAC,CAAC,UAAF,EAAa,SAAb;AAAtJ,CALO,EAMP;AAAC,UAAO,cAAR;AAAuB,UAAO,IAA9B;AAAmC,aAAU,wCAA7C;AAAsF,aAAU,MAAhG;AAAuG,WAAQ,MAA/G;AAAsH,iBAAc,CAAC,CAAC,SAAF,EAAY,SAAZ;AAApI,CANO,EAOP;AAAC,UAAO,oBAAR;AAA6B,UAAO,IAApC;AAAyC,aAAU,2CAAnD;AAA+F,aAAU,OAAzG;AAAiH,WAAQ,MAAzH;AAAgI,iBAAc,CAAC,CAAC,UAAF,EAAa,SAAb;AAA9I,CAPO,CAAT;AASA,MAAMC,kBAAkB,GAAG;AACzBC,EAAAA,QAAQ,EAAE,SADe;AAEzBC,EAAAA,SAAS,EAAE,SAFc;AAGzBC,EAAAA,IAAI,EAAE,CAHmB;AAIzBC,EAAAA,OAAO,EAAE,CAJgB;AAKzBC,EAAAA,KAAK,EAAE,CALkB;AAMzBV,EAAAA,KAAK,EAAE,GANkB;AAOzBC,EAAAA,MAAM,EAAE;AAPiB,CAA3B;AAcA,eAAe,MAAMU,GAAN,SAAkB5B,SAAlB,CAA4B;AAEzC6B,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACjB,UAAMA,KAAN;;AADiB,SA0HnBC,iBA1HmB,GA0HC,CAAC;AAACC,MAAAA;AAAD,KAAD,KAAiB;AAAE,WAAKC,QAAL,CAAc;AACnDC,QAAAA,QAAQ,oBAAO,KAAKC,KAAL,CAAWD,QAAlB,EAA+BF,SAA/B;AAD2C,OAAd;;AAGvC,UAAI,KAAKG,KAAL,CAAWC,eAAf,EAAgC;AAC9B,aAAKH,QAAL,CAAc;AAAEG,UAAAA,eAAe,EAAE,IAAnB;AAAyBC,UAAAA,aAAa,EAAE;AAAxC,SAAd;AACD;AACF,KAhIoB;;AAAA,SAqMnBC,OArMmB,GAqMT,MAAM,KAAKP,iBAAL,CAAuB;AACrCd,MAAAA,KAAK,EAAE,KAAKa,KAAL,CAAWb,KAAX,IAAoBsB,MAAM,CAACC,UADG;AAErCtB,MAAAA,MAAM,EAAE,KAAKY,KAAL,CAAWZ,MAAX,IAAqBqB,MAAM,CAACE;AAFC,KAAvB,CArMG;;AAEjB,SAAKN,KAAL,GAAa;AACXD,MAAAA,QAAQ,EAAE;AACRX,QAAAA,QAAQ,EAAE,SADF;AAERC,QAAAA,SAAS,EAAE,SAFH;AAGRC,QAAAA,IAAI,EAAE,CAHE;AAIRC,QAAAA,OAAO,EAAE,CAJD;AAKRC,QAAAA,KAAK,EAAE,CALC;AAMRV,QAAAA,KAAK,EAAE,GANC;AAORC,QAAAA,MAAM,EAAE;AAPA,OADC;AAUXwB,MAAAA,IAAI,EAAE,EAVK;AAWXC,MAAAA,KAAK,EAAE,EAXI;AAYXC,MAAAA,MAAM,EAAE,EAZG;AAaXP,MAAAA,aAAa,EAAE,IAbJ;AAcXD,MAAAA,eAAe,EAAE,IAdN;AAeXrB,MAAAA,CAAC,EAAE,CAfQ;AAgBXC,MAAAA,CAAC,EAAE;AAhBQ,KAAb;AAkBA,SAAK6B,QAAL,GAAgB,KAAKA,QAAL,CAAcC,IAAd,CAAmB,IAAnB,CAAhB;AACA,SAAKC,QAAL,GAAgB,KAAKA,QAAL,CAAcD,IAAd,CAAmB,IAAnB,CAAhB;AACA,SAAKE,WAAL,GAAmB,KAAKA,WAAL,CAAiBF,IAAjB,CAAsB,IAAtB,CAAnB;AACA,SAAKG,mBAAL,GAA2B,KAAKA,mBAAL,CAAyBH,IAAzB,CAA8B,IAA9B,CAA3B;AACD;;AAGDD,EAAAA,QAAQ,CAACK,IAAD,EAAO;AACb;AACA;AACA;AAHa,UAKLnC,CALK,GAKYmC,IALZ,CAKLnC,CALK;AAAA,UAKFC,CALE,GAKYkC,IALZ,CAKFlC,CALE;AAAA,UAKCmC,MALD,GAKYD,IALZ,CAKCC,MALD;AAMb,SAAKlB,QAAL,CAAc;AAAElB,MAAAA,CAAF;AAAKC,MAAAA,CAAL;AAAQqB,MAAAA,aAAa,EAAEc;AAAvB,KAAd;AACC;;AAEHJ,EAAAA,QAAQ,CAACG,IAAD,EAAO;AAAA,kCACkB,KAAKpB,KADvB,CACLsB,WADK;AAAA,UACLA,WADK,sCACS,IADT;AAAA,UAELrC,CAFK,GAEqBmC,IAFrB,CAELnC,CAFK;AAAA,UAEFC,CAFE,GAEqBkC,IAFrB,CAEFlC,CAFE;AAAA,UAECqC,OAFD,GAEqBH,IAFrB,CAECG,OAFD;AAAA,UAEUF,MAFV,GAEqBD,IAFrB,CAEUC,MAFV;;AAIb,QAAIA,MAAM,IAAIC,WAAd,EAA2B;AAEzB,WAAKnB,QAAL,CAAc;AAACC,QAAAA,QAAQ,oBAAK,KAAKC,KAAL,CAAWD,QAAhB;AAAyBX,UAAAA,QAAQ,EAAC4B,MAAM,CAAC5B,QAAzC;AAAkDC,UAAAA,SAAS,EAAC2B,MAAM,CAAC3B,SAAnE;AAA6EC,UAAAA,IAAI,EAAC;AAAlF,UAAT;AAA+FV,QAAAA,CAA/F;AAAkGC,QAAAA,CAAlG;AAAqGoB,QAAAA,eAAe,EAAEiB,OAAO,IAAI,CAACF,MAAD;AAAjI,OAAd;AAID,KAND,MAMO;AACL,WAAKH,WAAL;AACD;AACF;;AAEDA,EAAAA,WAAW,GAAG;AACZ,QAAI,KAAKb,KAAL,CAAWC,eAAf,EAAgC;AAC9B,WAAKH,QAAL,CAAc;AAAEI,QAAAA,aAAa,EAAE;AAAjB,OAAd;AACD;AACF;;AAEDY,EAAAA,mBAAmB,GAAG;AAAA,wBACW,KAAKd,KADhB;AAAA,UACZpB,CADY,eACZA,CADY;AAAA,UACTC,CADS,eACTA,CADS;AAAA,UACNqB,aADM,eACNA,aADM,EAGpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,QAAI,CAACA,aAAL,EAAoB;AAClB,aAAO,IAAP;AACD;;AACD,WAAOA,aAAa,IAClB;AAAK,MAAA,SAAS,EAAC,SAAf;AAAyB,MAAA,KAAK,EAAE;AAAEiB,QAAAA,IAAI,EAAEvC,CAAR;AAAWwC,QAAAA,GAAG,EAAEvC;AAAhB,OAAhC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACGqB,aAAa,CAACmB,cADjB,CADF;AAKD;;AAED,QAAMC,iBAAN,GAA0B;AACxB,UACEC,KAAK,CAAC,sGAAD,EACH;AACE,qBAAe,MADjB;AACyB,iBAAW;AAChC,kBAAU,mCADsB;AACe,wBAC7C;AAF8B,OADpC;AAKI,kBAAY,gFALhB;AAKkG,wBAC9F,4BANJ;AAMkC,cAAQ,IAN1C;AAMgD,gBAAU,KAN1D;AAMiE,cAAQ;AANzE,KADG,CAAL,CASGC,IATH,CASQC,CAAC,IAAIA,CAAC,CAACC,IAAF,EATb,EAUGF,IAVH,CAUQE,IAAI,IACR,KAAK5B,QAAL,CAAc;AACZS,MAAAA,IAAI,EAAE,CAAC;AAAEoB,QAAAA,IAAI,EAAED,IAAI,CAACnB,IAAL,CAAUqB,SAAV,CAAoBC,GAApB,CAAwBC,IAAI,IAAI,CAACA,IAAI,CAACC,GAAN,EAAWD,IAAI,CAACE,GAAhB,CAAhC;AAAR,OAAD,CADM;AAEZxB,MAAAA,KAAK,EAAEkB,IAAI,CAACnB,IAAL,CAAU0B,UAAV,CAAqBJ,GAArB,CAAyBC,IAAI,IAAI,CAACA,IAAI,CAACI,KAAL,CAAWC,QAAX,CAAoBJ,GAArB,EAA0BD,IAAI,CAACI,KAAL,CAAWC,QAAX,CAAoBH,GAA9C,CAAjC;AAFK,KAAd,CAXJ,CADF;AAiBA,UAAMI,MAAM,GAAGnE,UAAU,CAAC,uBAAD,CAAzB;AAGAmE,IAAAA,MAAM,CAACC,IAAP,CAAY,UAAZ,EAAwB;AACtBC,MAAAA,KAAK,EAAE;AADe,KAAxB,EArBwB,CAyBxB;;AACAF,IAAAA,MAAM,CAACG,EAAP,CAAU,aAAV,EAAyBhC,IAAI,IAAI,KAAKT,QAAL,CAAc;AAAEW,MAAAA,MAAM,EAAEF;AAAV,KAAd,CAAjC;AACAH,IAAAA,MAAM,CAACoC,gBAAP,CAAwB,QAAxB,EAAkC,KAAKrC,OAAvC;;AACA,SAAKA,OAAL;AACD;;AAEDsC,EAAAA,oBAAoB,GAAG;AACrBrC,IAAAA,MAAM,CAACsC,mBAAP,CAA2B,QAA3B,EAAqC,KAAKvC,OAA1C;AACD;;AAYHwC,EAAAA,aAAa,GAAG;AAGd,UAAMC,MAAM,GAAG,IAAIxE,gBAAJ,CAAqB;AAClCyE,MAAAA,EAAE,EAAE,mBAD8B;AAElCtC,MAAAA,IAAI,EAACrB,EAF6B;AAGlC4D,MAAAA,QAAQ,EAAE,IAHwB;AAIlCC,MAAAA,OAAO,EAAE,GAJyB;AAKlCC,MAAAA,OAAO,EAAE,IALyB;AAMlCC,MAAAA,MAAM,EAAE,IAN0B;AAOlCC,MAAAA,WAAW,EAAE,CAPqB;AAQlCC,MAAAA,eAAe,EAAE,CARiB;AASlCC,MAAAA,eAAe,EAAE,GATiB;AAUlCC,MAAAA,kBAAkB,EAAE,CAVc;AAWlCC,MAAAA,WAAW,EAAEC,CAAC,IAAIA,CAAC,CAACC,WAXc;AAYlCC,MAAAA,SAAS,EAAEF,CAAC,IAAIG,IAAI,CAACC,IAAL,CAAUJ,CAAC,CAACK,KAAZ,CAZkB;AAalCC,MAAAA,YAAY,EAAEN,CAAC,IAAI,CAAC,GAAD,EAAM,GAAN,EAAW,CAAX,CAbe;AAclCO,MAAAA,YAAY,EAAEP,CAAC,IAAI,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAde;AAelCQ,MAAAA,OAAO,EAAE,CAAC;AAAC/C,QAAAA,MAAD;AAASpC,QAAAA,CAAT;AAAYC,QAAAA;AAAZ,OAAD,KAAoB;AAC3B,cAAMmF,OAAO,aAAMhD,MAAM,CAACiD,IAAb,eAAsBjD,MAAM,CAACkD,OAA7B,CAAb;AACA;;;AAGD;AApBiC,KAArB,CAAf;AAwBE,UAAMC,KAAK,GAAG,IAAIhG,SAAJ,CAAc;AAC1B0E,MAAAA,EAAE,EAAE,YADsB;AAE1BtC,MAAAA,IAAI,EAAE,KAAKP,KAAL,CAAWO,IAFS;AAG1BuC,MAAAA,QAAQ,EAAE,IAHgB;AAI1BsB,MAAAA,UAAU,EAAE,CAJc;AAK1BC,MAAAA,cAAc,EAAE,CALU;AAM1BtB,MAAAA,OAAO,EAAE,GANiB;AAO1BuB,MAAAA,OAAO,EAAEf,CAAC,IAAI;AACZ,eAAOA,CAAC,CAAC5B,IAAT;AACD,OATyB;AAU1B4C,MAAAA,QAAQ,EAAEhB,CAAC,IAAI,CAAC,GAAD,EAAM,CAAN,EAAS,CAAT,CAVW;AAW1BiB,MAAAA,QAAQ,EAAEjB,CAAC,IAAI;AAXW,KAAd,CAAd;AAcA,UAAMkB,MAAM,GAAG,IAAIvG,SAAJ,CAAc;AAE3B2E,MAAAA,EAAE,EAAE,YAFuB;AAG3B;AACAtC,MAAAA,IAAI,EAAE,KAAKP,KAAL,CAAWS,MAJU;AAK3BqC,MAAAA,QAAQ,EAAE,IALiB;AAM3B4B,MAAAA,SAAS,EAAEnG,OANgB;AAO3BoG,MAAAA,WAAW,EAAEjG,YAPc;AAQ3BkG,MAAAA,OAAO,EAAErB,CAAC,IAAI,QARa;AAS3BsB,MAAAA,SAAS,EAAE,EATgB;AAU3B;AACAvB,MAAAA,WAAW,EAAEC,CAAC,IAAI,CAACA,CAAC,CAACxB,GAAH,EAAOwB,CAAC,CAACvB,GAAT,CAXS;AAY3B8C,MAAAA,OAAO,EAAEvB,CAAC,IAAI,CAZa;AAa3BgB,MAAAA,QAAQ,EAAEhB,CAAC,IAAI,CAAC,EAAD,EAAK,GAAL,EAAU,EAAV,CAbY;AAc3BQ,MAAAA,OAAO,EAAE,KAAKrD,QAda;AAe3BqE,MAAAA,OAAO,EAAE,KAAKnE;AAfa,KAAd,CAAf,CAzCY,CA2DZ;AACA;AACA;;AACA,WAAO,CAACuD,KAAD,EAAOvB,MAAP,CAAP;AACD;;AAODoC,EAAAA,MAAM,GAAG;AAAA,UACAjF,QADA,GACY,KAAKC,KADjB,CACAD,QADA;AAEP,WACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACA,oBAAC,MAAD;AACE,MAAA,SAAS,EAAEA,QADb;AAEE,MAAA,gBAAgB,EAAEZ,kBAFpB;AAGE,MAAA,UAAU,EAAE,IAHd;AAIE,MAAA,MAAM,EAAE,KAAKwD,aAAL,EAJV;AAKE,MAAA,iBAAiB,EAAE,KAAK/C,iBAL1B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAQE,oBAAC,SAAD;AAAW,MAAA,oBAAoB,EAAEnB,mBAAjC;AACW,MAAA,QAAQ,EAAE,gCADrB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MARF,EAWC,KAAKqC,mBAXN,CADA,EAcA,oBAAC,YAAD;AACA,MAAA,kBAAkB,EAAE,KAAKnB,KAAL,CAAWsF,kBAD/B;AAEA,MAAA,KAAK,EAAE,KAAKjF,KAFZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAdA,CADF;AAwBD;;AAtOwC","sourcesContent":["import React, { Component } from 'react';\nimport MapGL, { Marker, FlyToInterpolator } from 'react-map-gl';\nimport openSocket from 'socket.io-client';\nimport 'mapbox-gl/dist/mapbox-gl.css';\nimport { IconLayer, PathLayer, ScatterplotLayer } from '@deck.gl/layers';\nimport DeckGL from '@deck.gl/react';\nimport { StaticMap } from 'react-map-gl';\nimport busicon from \"./busicon.png\";\nimport ControlPanel from './control-panel';\n\n\nconst MAPBOX_ACCESS_TOKEN = 'pk.eyJ1IjoiYXM0NzIiLCJhIjoiY2p3MGFmdnVoMDhiMDQwa3RkZno4Z2NncCJ9.MssP16N-csE73s0v2p_z8A';\nconst ICON_MAPPING = {\n  marker: { x: 0, y: 0, width: 512, height: 512, mask: false, anchorY: 512 }\n};\n\nconst ti=[\n  {\"name\":\"Lafayette (LAFY)\",\"code\":\"LF\",\"address\":\"3601 Deer Hill Road, Lafayette CA 94549\",\"entries\":\"3481\",\"exits\":\"3616\",\"coordinates\":[-122.123801,37.893394]},\n  {\"name\":\"12th St. Oakland City Center (12TH)\",\"code\":\"12\",\"address\":\"1245 Broadway, Oakland CA 94612\",\"entries\":\"13418\",\"exits\":\"13547\",\"coordinates\":[-122.271604,37.803664]},\n  {\"name\":\"16th St. Mission (16TH)\",\"code\":\"16\",\"address\":\"2000 Mission Street, San Francisco CA 94110\",\"entries\":\"12409\",\"exits\":\"12351\",\"coordinates\":[-122.419694,37.765062]},\n  {\"name\":\"19th St. Oakland (19TH)\",\"code\":\"19\",\"address\":\"1900 Broadway, Oakland CA 94612\",\"entries\":\"13108\",\"exits\":\"13090\",\"coordinates\":[-122.269029,37.80787]},\n  {\"name\":\"24th St. Mission (24TH)\",\"code\":\"24\",\"address\":\"2800 Mission Street, San Francisco CA 94110\",\"entries\":\"12817\",\"exits\":\"12529\",\"coordinates\":[-122.418466,37.752254]},\n  {\"name\":\"Ashby (ASHB)\",\"code\":\"AS\",\"address\":\"3100 Adeline Street, Berkeley CA 94703\",\"entries\":\"5452\",\"exits\":\"5341\",\"coordinates\":[-122.26978,37.853024]},\n  {\"name\":\"Balboa Park (BALB)\",\"code\":\"BP\",\"address\":\"401 Geneva Avenue, San Francisco CA 94112\",\"entries\":\"11170\",\"exits\":\"9817\",\"coordinates\":[-122.447414,37.721981]}\n];\nconst INITIAL_VIEW_STATE = {\n  latitude: 21.146633,\n  longitude: 79.088860,\n  zoom: 5,\n  bearing: 0,\n  pitch: 0,\n  width: 100,\n  height: 100\n}\n\n\n\n\n\nexport default class App extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      viewport: {\n        latitude: 21.146633,\n        longitude: 79.088860,\n        zoom: 4,\n        bearing: 0,\n        pitch: 0,\n        width: 100,\n        height: 100\n      },\n      data: [],\n      stops: [],\n      stops1: [],\n      hoveredObject: null,\n      expandedObjects: null,\n      x: 0,\n      y: 0\n    }\n    this._onHover = this._onHover.bind(this);\n    this._onClick = this._onClick.bind(this);\n    this._closePopup = this._closePopup.bind(this);\n    this._renderhoveredItems = this._renderhoveredItems.bind(this);\n  }\n\n\n  _onHover(info) {\n    // if (this.state.expandedObjects) {\n    //   return;\n    // }\n\n    const { x, y, object } = info;\n    this.setState({ x, y, hoveredObject: object });\n    }\n\n  _onClick(info) {\n    const { showCluster = true } = this.props;\n    const { x, y, objects, object } = info;\n\n    if (object && showCluster) {\n      \n      this.setState({viewport:{...this.state.viewport,latitude:object.latitude,longitude:object.longitude,zoom:12},x, y, expandedObjects: objects || [object]\n        \n      });\n      \n    } else {\n      this._closePopup();\n    }\n  }\n\n  _closePopup() {\n    if (this.state.expandedObjects) {\n      this.setState({ hoveredObject: null });\n    }\n  }\n\n  _renderhoveredItems() {\n    const { x, y, hoveredObject} = this.state;\n\n    // if (expandedObjects) {\n    //   return (\n    //     <div className=\"tooltip interactive\" style={{ left: x, top: y }}>\n    //       {\n    //         expandedObjects.map(({ source_type, driver_name, vehicle_number }) => {\n    //           return (\n    //             <div key=\"Details\">\n    //               <h4>Details</h4>\n    //               <div>Driver Name: {driver_name}</div>\n    //               <div>Vehicle Number: {vehicle_number}</div>\n    //             </div>\n    //           );\n    //         })}\n    //     </div>\n    //   );\n    // }\n\n    if (!hoveredObject) {\n      return null;\n    }\n    return hoveredObject && (\n      <div className=\"tooltip\" style={{ left: x, top: y }}>\n        {hoveredObject.vehicle_number}\n      </div>\n    );\n  }\n\n  async componentDidMount() {\n    await\n      fetch(\"https://service-panel-backend.shuttltech.com/api/v1/routes/125e9bde-22c0-4e5d-936d-66dcadc74174/path\",\n        {\n          \"credentials\": \"omit\", \"headers\": {\n            \"accept\": \"application/json, text/plain, */*\", \"x-session-id\":\n              \"633K4LTHCBNXWVS3DOGUW44MGH7ICKVOBNP7QUEVD5J3JRPBFVLWCZWGPESIXXV7NGNVR5RTD66X3OZYPKKOVC6DUYIBTBGVAOSEJYA\"\n          }\n          , \"referrer\": \"https://service-panel.shuttltech.com/trip/01a035d8-7436-43f4-b311-9ac3916af099\", \"referrerPolicy\":\n            \"no-referrer-when-downgrade\", \"body\": null, \"method\": \"GET\", \"mode\": \"cors\"\n        })\n        .then(_ => _.json())\n        .then(json =>\n          this.setState({\n            data: [{ path: json.data.locations.map(item => [item.lng, item.lat])}],\n            stops: json.data.way_points.map(item => [item.point.location.lng, item.point.location.lat])\n          }));\n\n    const socket = openSocket('http://127.0.0.1:5000');\n\n\n    socket.emit('my event', {\n      Arpit: \"Hello!\"\n    })\n\n    // socket.emit('my event', this.state.stops)\n    socket.on('my response', data => this.setState({ stops1: data }))\n    window.addEventListener('resize', this._resize);\n    this._resize();\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('resize', this._resize);\n  }\n\n  _onViewportChange = ({viewState}) => { this.setState({\n    viewport: { ...this.state.viewport, ...viewState }\n  });\n  if (this.state.expandedObjects) {\n    this.setState({ expandedObjects: null, hoveredObject: null });\n  }\n}\n\n  \n\n_renderLayers() {\n\n\n  const layer2 = new ScatterplotLayer({\n    id: 'scatterplot-layer',\n    data:ti,\n    pickable: true,\n    opacity: 0.8,\n    stroked: true,\n    filled: true,\n    radiusScale: 6,\n    radiusMinPixels: 1,\n    radiusMaxPixels: 100,\n    lineWidthMinPixels: 1,\n    getPosition: d => d.coordinates,\n    getRadius: d => Math.sqrt(d.exits),\n    getFillColor: d => [255, 140, 0],\n    getLineColor: d => [0, 0, 0],\n    onHover: ({object, x, y}) => {\n      const tooltip = `${object.name}\\n${object.address}`;\n      /* Update tooltip\n         http://deck.gl/#/documentation/developer-guide/adding-interactivity?section=example-display-a-tooltip-for-hovered-object\n      */\n    }\n  });\n\n\n    const layer = new PathLayer({\n      id: 'path-layer',\n      data: this.state.data,\n      pickable: true,\n      widthScale: 2,\n      widthMinPixels: 2,\n      opacity: 0.8,\n      getPath: d => {\n        return d.path\n      },\n      getColor: d => [255, 0, 0],\n      getWidth: d => 4\n    });\n\n    const layer1 = new IconLayer({\n\n      id: 'icon-layer',\n      // data: Array(5000).fill(this.state.stops1).flat(),\n      data: this.state.stops1,\n      pickable: true,\n      iconAtlas: busicon,\n      iconMapping: ICON_MAPPING,\n      getIcon: d => 'marker',\n      sizeScale: 15,\n      // getPosition: (d, a) => [d.longitude + (a.index * 0.01), d.latitude + (a.index * 0.01)],\n      getPosition: d => [d.lng,d.lat],\n      getSize: d => 4,\n      getColor: d => [14, 200, 50],\n      onHover: this._onHover,\n      onClick: this._onClick\n    });\n     \n    // if(this.state.expandedObjects)\n    // return [layer2];\n    // else return [layer2];\n    return [layer,layer2];\n  }\n\n  _resize = () => this._onViewportChange({\n    width: this.props.width || window.innerWidth,\n    height: this.props.height || window.innerHeight\n  });\n\n  render() {\n    const {viewport} = this.state;\n    return (\n      <div>\n      <DeckGL\n        viewState={viewport}\n        initialViewState={INITIAL_VIEW_STATE}\n        controller={true}\n        layers={this._renderLayers()}\n        onViewStateChange={this._onViewportChange}\n        \n        >\n        <StaticMap mapboxApiAccessToken={MAPBOX_ACCESS_TOKEN}\n                   mapStyle={\"mapbox://styles/mapbox/dark-v9\"} />\n\n      {this._renderhoveredItems}\n      </DeckGL>\n      <ControlPanel\n      containerComponent={this.props.containerComponent}\n      propp={this.state}\n      \n    />\n\n    </div>\n    );\n\n  }\n}"]},"metadata":{},"sourceType":"module"}