{"ast":null,"code":"import _objectSpread from \"/Users/admin/Desktop/visualization/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nvar _jsxFileName = \"/Users/admin/Desktop/visualization/src/App.js\";\nimport React, { Component } from 'react';\nimport MapGL, { Marker, FlyToInterpolator } from 'react-map-gl';\nimport CityPin from \"./city-pin.js\";\nimport openSocket from 'socket.io-client';\nimport CITIES from './cities.json';\nimport ashish from './ashish.json';\nimport tiki from \"./tiki.json\";\nimport a from \"./a.json\";\nimport 'mapbox-gl/dist/mapbox-gl.css';\nimport { IconLayer, PathLayer } from '@deck.gl/layers';\nimport DeckGL from '@deck.gl/react';\nimport ReactMapGL, { StaticMap } from 'react-map-gl';\nimport busicon from \"./busicon.png\";\nimport driver from \"./driver.json\";\nconst MAPBOX_ACCESS_TOKEN = 'pk.eyJ1IjoiYXM0NzIiLCJhIjoiY2p3MGFmdnVoMDhiMDQwa3RkZno4Z2NncCJ9.MssP16N-csE73s0v2p_z8A';\nconst ICON_MAPPING = {\n  marker: {\n    x: 0,\n    y: 0,\n    width: 512,\n    height: 512,\n    mask: false,\n    anchorY: 512\n  }\n};\nconst INITIAL_VIEW_STATE = {\n  latitude: 12.9222,\n  longitude: 77.65949,\n  zoom: 10,\n  bearing: 0,\n  pitch: 0,\n  width: 100,\n  height: 100\n};\nexport default class App extends Component {\n  constructor(props) {\n    super(props);\n\n    this._onViewportChange = viewport => this.setState({\n      viewport: _objectSpread({}, this.state.viewport, viewport)\n    });\n\n    this._updateViewport = viewport => {\n      this.setState({\n        viewport\n      });\n    };\n\n    this._goToViewport = ({\n      longitude,\n      latitude\n    }) => {\n      this._onViewportChange({\n        longitude,\n        latitude,\n        zoom: 15\n      });\n    };\n\n    this._resize = () => this._onViewportChange({\n      width: this.props.width || window.innerWidth,\n      height: this.props.height || window.innerHeight\n    });\n\n    this.state = {\n      latitude: 28.431108,\n      longitude: 77.036291,\n      zoom: 4,\n      data: [],\n      stops: [],\n      stops1: [],\n      hoveredObject: null,\n      expandedObjects: null,\n      x: 0,\n      y: 0\n    };\n    this._onHover = this._onHover.bind(this);\n    this._onClick = this._onClick.bind(this);\n    this._closePopup = this._closePopup.bind(this);\n    this._renderhoveredItems = this._renderhoveredItems.bind(this);\n    this._goToViewport = this._goToViewport.bind(this);\n    this.onViewportChange = this.onViewportChange.bind(this);\n  }\n\n  _onHover(info) {\n    if (this.state.expandedObjects) {\n      return;\n    }\n\n    const x = info.x,\n          y = info.y,\n          object = info.object;\n    this.setState({\n      x,\n      y,\n      hoveredObject: object\n    });\n  }\n\n  _onClick(info) {\n    const _this$props$showClust = this.props.showCluster,\n          showCluster = _this$props$showClust === void 0 ? true : _this$props$showClust;\n    const x = info.x,\n          y = info.y,\n          objects = info.objects,\n          object = info.object;\n\n    if (object && showCluster) {\n      this.setState({\n        viewport: _objectSpread({}, this.state.viewport, {\n          latitude: object.latitude,\n          longitude: object.longitude,\n          zoom: 15\n        }),\n        x,\n        y,\n        expandedObjects: objects || [object]\n      });\n    } else {\n      this._closePopup();\n    }\n  }\n\n  _closePopup() {\n    if (this.state.expandedObjects) {\n      this.setState({\n        expandedObjects: null,\n        hoveredObject: null\n      });\n    }\n  }\n\n  _renderhoveredItems() {\n    const _this$state = this.state,\n          x = _this$state.x,\n          y = _this$state.y,\n          hoveredObject = _this$state.hoveredObject,\n          expandedObjects = _this$state.expandedObjects;\n\n    if (expandedObjects) {\n      return React.createElement(\"div\", {\n        className: \"tooltip interactive\",\n        style: {\n          left: x,\n          top: y\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 91\n        },\n        __self: this\n      }, expandedObjects.map(({\n        source_type,\n        driver_name,\n        vehicle_number\n      }) => {\n        return React.createElement(\"div\", {\n          key: \"Details\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 95\n          },\n          __self: this\n        }, React.createElement(\"h4\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 96\n          },\n          __self: this\n        }, \"Details\"), React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 97\n          },\n          __self: this\n        }, \"Driver Name: \", driver_name), React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 98\n          },\n          __self: this\n        }, \"Vehicle Number: \", vehicle_number));\n      }));\n    }\n\n    if (!hoveredObject) {\n      return null;\n    }\n\n    return hoveredObject && React.createElement(\"div\", {\n      className: \"tooltip\",\n      style: {\n        left: x,\n        top: y\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 110\n      },\n      __self: this\n    }, hoveredObject.vehicle_number);\n  }\n\n  async componentDidMount() {\n    await fetch(\"https://service-panel-backend.shuttltech.com/api/v1/routes/125e9bde-22c0-4e5d-936d-66dcadc74174/path\", {\n      \"credentials\": \"omit\",\n      \"headers\": {\n        \"accept\": \"application/json, text/plain, */*\",\n        \"x-session-id\": \"633K4LTHCBNXWVS3DOGUW44MGH7ICKVOBNP7QUEVD5J3JRPBFVLWCZWGPESIXXV7NGNVR5RTD66X3OZYPKKOVC6DUYIBTBGVAOSEJYA\"\n      },\n      \"referrer\": \"https://service-panel.shuttltech.com/trip/01a035d8-7436-43f4-b311-9ac3916af099\",\n      \"referrerPolicy\": \"no-referrer-when-downgrade\",\n      \"body\": null,\n      \"method\": \"GET\",\n      \"mode\": \"cors\"\n    }).then(_ => _.json()).then(json => this.setState({\n      data: [{\n        path: json.data.locations.map(item => [item.lng, item.lat])\n      }],\n      stops: json.data.way_points.map(item => [item.point.location.lng, item.point.location.lat])\n    }));\n    const socket = openSocket('http://127.0.0.1:5000');\n    socket.emit('my event', {\n      Arpit: \"Hello!\"\n    });\n    socket.on('my response', data => this.setState({\n      stops1: data\n    }));\n    window.addEventListener('resize', this._resize);\n\n    this._resize();\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('resize', this._resize);\n  }\n\n  onViewportChange(viewport) {\n    const latitude = viewport.latitude,\n          longitude = viewport.longitude,\n          zoom = viewport.zoom;\n    this.setState({\n      latitude,\n      longitude,\n      zoom\n    });\n  }\n\n  renderLayers() {\n    const layer = new PathLayer({\n      id: 'path-layer',\n      data: this.state.data,\n      pickable: true,\n      widthScale: 2,\n      widthMinPixels: 2,\n      opacity: 0.8,\n      getPath: d => {\n        console.log(1234, this.state.stops1);\n        return d.path;\n      },\n      getColor: d => [255, 0, 0],\n      getWidth: d => 4\n    });\n    const layer1 = new IconLayer({\n      id: 'icon-layer',\n      // data: Array(5000).fill(this.state.stops1).flat(),\n      data: this.state.stops1,\n      pickable: true,\n      iconAtlas: busicon,\n      iconMapping: ICON_MAPPING,\n      getIcon: d => 'marker',\n      sizeScale: 15,\n      getPosition: (d, a) => [d.longitude + a.index * 0.01, d.latitude + a.index * 0.01],\n      getSize: d => 4,\n      getColor: d => [14, 200, 50],\n      onHover: this._onHover\n    });\n    return [layer, layer1];\n  }\n\n  render() {\n    const _this$state2 = this.state,\n          latitude = _this$state2.latitude,\n          longitude = _this$state2.longitude,\n          zoom = _this$state2.zoom;\n    const _window = window,\n          width = _window.innerWidth,\n          height = _window.innerHeight;\n    const viewport = {\n      width,\n      height,\n      longitude,\n      latitude,\n      zoom,\n      pitch: 0,\n      bearing: 0\n    };\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 229\n      },\n      __self: this\n    }, React.createElement(ReactMapGL, Object.assign({}, viewport, {\n      mapboxApiAccessToken: MAPBOX_ACCESS_TOKEN,\n      mapStyle: \"mapbox://styles/mapbox/dark-v9\",\n      onViewportChange: vp => this.onViewportChange(vp),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 230\n      },\n      __self: this\n    }), React.createElement(DeckGL, Object.assign({}, viewport, {\n      layers: this.renderLayers(),\n      onViewStateChange: this._closePopup,\n      onClick: this._onClick,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 238\n      },\n      __self: this\n    })), this._renderhoveredItems));\n  }\n\n}","map":{"version":3,"sources":["/Users/admin/Desktop/visualization/src/App.js"],"names":["React","Component","MapGL","Marker","FlyToInterpolator","CityPin","openSocket","CITIES","ashish","tiki","a","IconLayer","PathLayer","DeckGL","ReactMapGL","StaticMap","busicon","driver","MAPBOX_ACCESS_TOKEN","ICON_MAPPING","marker","x","y","width","height","mask","anchorY","INITIAL_VIEW_STATE","latitude","longitude","zoom","bearing","pitch","App","constructor","props","_onViewportChange","viewport","setState","state","_updateViewport","_goToViewport","_resize","window","innerWidth","innerHeight","data","stops","stops1","hoveredObject","expandedObjects","_onHover","bind","_onClick","_closePopup","_renderhoveredItems","onViewportChange","info","object","showCluster","objects","left","top","map","source_type","driver_name","vehicle_number","componentDidMount","fetch","then","_","json","path","locations","item","lng","lat","way_points","point","location","socket","emit","Arpit","on","addEventListener","componentWillUnmount","removeEventListener","renderLayers","layer","id","pickable","widthScale","widthMinPixels","opacity","getPath","d","console","log","getColor","getWidth","layer1","iconAtlas","iconMapping","getIcon","sizeScale","getPosition","index","getSize","onHover","render","vp"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport MapGL, { Marker, FlyToInterpolator } from 'react-map-gl';\nimport CityPin from \"./city-pin.js\";\nimport openSocket from 'socket.io-client';\nimport CITIES from './cities.json';\nimport ashish from './ashish.json'\nimport tiki from \"./tiki.json\"\nimport a from \"./a.json\"\nimport 'mapbox-gl/dist/mapbox-gl.css';\nimport { IconLayer, PathLayer } from '@deck.gl/layers';\nimport DeckGL from '@deck.gl/react';\nimport ReactMapGL,{ StaticMap } from 'react-map-gl';\nimport busicon from \"./busicon.png\";\nimport driver from \"./driver.json\"\n\n\nconst MAPBOX_ACCESS_TOKEN = 'pk.eyJ1IjoiYXM0NzIiLCJhIjoiY2p3MGFmdnVoMDhiMDQwa3RkZno4Z2NncCJ9.MssP16N-csE73s0v2p_z8A';\nconst ICON_MAPPING = {\n  marker: { x: 0, y: 0, width: 512, height: 512, mask: false, anchorY: 512 }\n};\nconst INITIAL_VIEW_STATE = {\n  latitude: 12.9222,\n  longitude: 77.65949,\n  zoom: 10,\n  bearing: 0,\n  pitch: 0,\n  width: 100,\n  height: 100\n}\n\n\n\nexport default class App extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      latitude: 28.431108,\n      longitude:77.036291,\n      zoom:4,\n      data: [],\n      stops: [],\n      stops1: [],\n      hoveredObject: null,\n      expandedObjects: null,\n      x: 0,\n      y: 0\n    }\n    this._onHover = this._onHover.bind(this);\n    this._onClick = this._onClick.bind(this);\n    this._closePopup = this._closePopup.bind(this);\n    this._renderhoveredItems = this._renderhoveredItems.bind(this);\n    this._goToViewport=this._goToViewport.bind(this);\n    this.onViewportChange=this.onViewportChange.bind(this);\n    \n\n  }\n\n\n  _onHover(info) {\n    if (this.state.expandedObjects) {\n      return;\n    }\n\n    const { x, y, object } = info;\n    this.setState({ x, y, hoveredObject: object });\n  }\n\n  _onClick(info) {\n    const { showCluster = true } = this.props;\n    const { x, y, objects, object } = info;\n\n    if (object && showCluster) {\n      this.setState({viewport:{...this.state.viewport,latitude:object.latitude,longitude:object.longitude,zoom:15}, x, y, expandedObjects: objects || [object] });\n    } else {\n      this._closePopup();\n    }\n  }\n\n  _closePopup() {\n    if (this.state.expandedObjects) {\n      this.setState({ expandedObjects: null, hoveredObject: null });\n    }\n  }\n\n  _renderhoveredItems() {\n    const { x, y, hoveredObject, expandedObjects } = this.state;\n\n    if (expandedObjects) {\n      return (\n        <div className=\"tooltip interactive\" style={{ left: x, top: y }}>\n          {\n            expandedObjects.map(({ source_type, driver_name, vehicle_number }) => {\n              return (\n                <div key=\"Details\">\n                  <h4>Details</h4>\n                  <div>Driver Name: {driver_name}</div>\n                  <div>Vehicle Number: {vehicle_number}</div>\n                </div>\n              );\n            })}\n        </div>\n      );\n    }\n\n    if (!hoveredObject) {\n      return null;\n    }\n    return hoveredObject && (\n      <div className=\"tooltip\" style={{ left: x, top: y }}>\n        {hoveredObject.vehicle_number}\n      </div>\n    );\n  }\n\n  async componentDidMount() {\n    await\n      fetch(\"https://service-panel-backend.shuttltech.com/api/v1/routes/125e9bde-22c0-4e5d-936d-66dcadc74174/path\",\n        {\n          \"credentials\": \"omit\", \"headers\": {\n            \"accept\": \"application/json, text/plain, */*\", \"x-session-id\":\n              \"633K4LTHCBNXWVS3DOGUW44MGH7ICKVOBNP7QUEVD5J3JRPBFVLWCZWGPESIXXV7NGNVR5RTD66X3OZYPKKOVC6DUYIBTBGVAOSEJYA\"\n          }\n          , \"referrer\": \"https://service-panel.shuttltech.com/trip/01a035d8-7436-43f4-b311-9ac3916af099\", \"referrerPolicy\":\n            \"no-referrer-when-downgrade\", \"body\": null, \"method\": \"GET\", \"mode\": \"cors\"\n        })\n        .then(_ => _.json())\n        .then(json =>\n          this.setState({\n            data: [{ path: json.data.locations.map(item => [item.lng, item.lat])}],\n            stops: json.data.way_points.map(item => [item.point.location.lng, item.point.location.lat])\n          }));\n\n    const socket = openSocket('http://127.0.0.1:5000');\n\n\n    socket.emit('my event', {\n      Arpit: \"Hello!\"\n    })\n\n    socket.on('my response', data => this.setState({ stops1: data }))\n    window.addEventListener('resize', this._resize);\n    this._resize();\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('resize', this._resize);\n  }\n\n  _onViewportChange = viewport => this.setState({\n    viewport: { ...this.state.viewport, ...viewport }\n  });\n\n  onViewportChange(viewport) {\n    const { latitude, longitude, zoom } = viewport\n    this.setState({ latitude, longitude, zoom })\n  }\n\n  _updateViewport = viewport => {\n    this.setState({ viewport });\n  };\n\n  _goToViewport = ({longitude, latitude}) => {\n    this._onViewportChange({\n      longitude,\n      latitude,\n      zoom: 15,\n    });\n  };\n\n\n  renderLayers() {\n\n    const layer = new PathLayer({\n      id: 'path-layer',\n      data: this.state.data,\n      pickable: true,\n      widthScale: 2,\n      widthMinPixels: 2,\n      opacity: 0.8,\n      getPath: d => {\n        console.log(1234, this.state.stops1);\n        return d.path\n      },\n      getColor: d => [255, 0, 0],\n      getWidth: d => 4\n    });\n\n    const layer1 = new IconLayer({\n\n      id: 'icon-layer',\n      // data: Array(5000).fill(this.state.stops1).flat(),\n      data: this.state.stops1,\n      pickable: true,\n      iconAtlas: busicon,\n      iconMapping: ICON_MAPPING,\n      getIcon: d => 'marker',\n      sizeScale: 15,\n      getPosition: (d, a) => [d.longitude + (a.index * 0.01), d.latitude + (a.index * 0.01)],\n      \n      getSize: d => 4,\n      getColor: d => [14, 200, 50],\n      onHover: this._onHover\n    });\n\n    return [layer, layer1];\n  }\n\n  _resize = () => this._onViewportChange({\n    width: this.props.width || window.innerWidth,\n    height: this.props.height || window.innerHeight\n  });\n\n  render() {\n\n    const {latitude,longitude,zoom} = this.state\n    const { innerWidth: width, innerHeight: height } = window\n    const viewport = {\n      width,\n      height,\n      longitude,\n      latitude,\n      zoom,\n      pitch: 0,\n      bearing: 0\n    }\n\n    return (\n          <div>\n          <ReactMapGL\n            {...viewport}\n            mapboxApiAccessToken={MAPBOX_ACCESS_TOKEN}\n            mapStyle={\"mapbox://styles/mapbox/dark-v9\"}\n            onViewportChange={vp => this.onViewportChange(vp)}>\n\n\n      \n     <DeckGL\n        {...viewport}\n        layers={this.renderLayers()}\n        onViewStateChange={this._closePopup}\n        onClick={this._onClick}>\n      </DeckGL>\n\n        \n        {this._renderhoveredItems}\n      </ReactMapGL>\n      </div>\n    );\n\n  }\n\n}"]},"metadata":{},"sourceType":"module"}